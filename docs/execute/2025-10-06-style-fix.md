# 2025-10-06 实施记录（前后端联调与前端 UI 优化）

本次实施内容涵盖前端 UI 优化（自定义下拉组件与主页布局无滚动）以及后端联通问题修复（Visit 接口端口对齐）。

## 前端改动

- 新增自定义下拉组件：
  - 代码位置：`front-web/src/components/ui/Dropdown.tsx`
  - 样式文件：`front-web/src/components/ui/Dropdown.module.css`
  - 特性：玻璃拟态样式、圆角与阴影、Hover/选中态、暗黑模式兼容、Chevron 图标旋转、点击外部关闭、键盘导航基础支持。
- 导航栏集成：
  - 更新 `front-web/src/components/Navbar.tsx`，用自定义 `Dropdown` 替换原生 `<select>`，保持原有页面导航与语言切换逻辑。
- 首页布局无滚动（填满视口）：
  - 更新 `front-web/src/app/layout.module.css`：`.main { box-sizing: border-box; height: 100vh; padding-top: var(--navbar-height); overflow: hidden; }`
  - 更新 `front-web/src/app/page.module.css`：`.container { min-height: 100%; height: 100%; }` 并移除 `.artText` 的默认外边距，避免细微溢出导致滚动条。
  - 更新 `front-web/src/app/globals.css`：重置 `html, body` 高度与 `body` margin，统一 `box-sizing`。
  - 结果：导航栏 + 内容区精准填满视口，主页在内容不超出时不出现滚动条；内容超出时可按需调整样式以启用内部滚动。

## 后端联通与端口对齐

- 访问记录接口：`POST /logs/visit`
- 后端端口：在 `server/internal/cmd/cmd.go` 中显式配置 `s.SetPort(8080)`。
- 前端默认 API 基地址：`NEXT_PUBLIC_API_BASE=http://localhost:8080`。
  - 更新文件：`front-web/src/components/VisitTracker.tsx`，将默认值由 `http://localhost:8000` 更正为 `http://localhost:8080`。
- 服务器启动：在 `D:\Code\JieCool\server` 执行 `go run main.go` 后，`http://localhost:8080/logs/visit` 可正常接收上报。
- CORS 提醒：如前后端不同源需在后端开启跨域（允许前端 Origin、POST 方法与 Content-Type 头）。

## 文档更新

- `docs/api/visit.md`：
  - 将默认 `NEXT_PUBLIC_API_BASE` 更正为 `http://localhost:8080` 并与后端端口配置对齐。
  - 修正 cURL 示例端口至 8080。
- 本记录文件：新增，汇总本次实施与对齐事项。

## 已知问题与后续计划

- 键盘无障碍：可进一步完善 Dropdown 的键盘导航（上下箭头选择、Enter 选中、Esc 关闭），并确保 ARIA 属性完整。
- 响应式优化：根据移动端手势与小屏场景优化点击区域与弹层位置。
- 配置灵活性：推荐在 `front-web/.env.local` 中设置 `NEXT_PUBLIC_API_BASE`，减少对默认值的依赖；生产环境按实际域名与网关策略配置。

## 验证

- 前端：`http://localhost:3000/` 首页不出现多余滚动条，导航 Dropdown 正常。
- 后端：`curl -X POST http://localhost:8080/logs/visit` 返回 200 且记录持久化（优先 PostgreSQL，降级写入 `server/data/visit.log`）。